# ProGuard Configuration for WareStat
# This configuration ensures the application remains functional after obfuscation

# ============================================
# Basic Settings
# ============================================

# Don't warn about missing classes from external libraries
-dontwarn **

# Preserve debugging info for better stack traces (you can remove this for maximum obfuscation)
-keepattributes SourceFile,LineNumberTable

# Keep all annotations (required for some frameworks)
-keepattributes *Annotation*

# Keep generic signatures (for proper type information)
-keepattributes Signature

# Optimization settings
-optimizationpasses 5
-dontusemixedcaseclassnames
-verbose

# Save mapping file to decode obfuscated stack traces
-printmapping dist/mapping.txt

# ============================================
# Main Application Entry Point
# ============================================

# Keep the main class and its main method
-keep public class MainWindow {
    public static void main(java.lang.String[]);
}

# Keep all public classes (your application classes)
# Adjust this if you want more aggressive obfuscation
-keep public class * {
    public protected *;
}

# ============================================
# Swing/AWT GUI Components
# ============================================

# Keep all classes that extend Swing/AWT components
-keep public class * extends javax.swing.** {
    <init>(...);
}

-keep public class * extends java.awt.** {
    <init>(...);
}

# Keep all event listeners and their methods
-keep class * implements java.awt.event.** {
    <methods>;
}

-keep class * implements javax.swing.event.** {
    <methods>;
}

# Keep all classes with Action listeners
-keepclassmembers class * {
    void *(**ActionEvent);
}

# Keep constructors for GUI components
-keepclassmembers class * extends javax.swing.JComponent {
    <init>(...);
}

# ============================================
# Database (SQLite JDBC)
# ============================================

# Keep JDBC driver classes (loaded via reflection)
-keep class org.sqlite.** {
    *;
}

# Keep all JDBC-related classes
-keep class * implements java.sql.Driver {
    *;
}

-keep class java.sql.** {
    *;
}

# Keep database-related classes from your application
-keep class DatabaseManager {
    *;
}

# ============================================
# PDF Generation (Apache PDFBox)
# ============================================

# Keep PDFBox classes (they may use reflection internally)
-keep class org.apache.pdfbox.** {
    *;
}

-keep class org.apache.fontbox.** {
    *;
}

# Keep your PDF generator class
-keep class InvoicePDFGenerator {
    *;
}

# ============================================
# Serialization Support
# ============================================

# Keep serialization-related methods
-keepclassmembers class * implements java.io.Serializable {
    static final long serialVersionUID;
    private static final java.io.ObjectStreamField[] serialPersistentFields;
    private void writeObject(java.io.ObjectOutputStream);
    private void readObject(java.io.ObjectInputStream);
    java.lang.Object writeReplace();
    java.lang.Object readResolve();
}

# ============================================
# Enumerations
# ============================================

# Keep enumeration values
-keepclassmembers enum * {
    public static **[] values();
    public static ** valueOf(java.lang.String);
}

# ============================================
# Native Methods
# ============================================

# Keep native method names (they're called from native code)
-keepclasseswithmembernames class * {
    native <methods>;
}

# ============================================
# Resource Files
# ============================================

# Keep resource files
-keepdirectories
-keep class **.R
-keep class **.R$* {
    <fields>;
}

# ============================================
# Optional: More Aggressive Obfuscation
# ============================================

# Uncomment these for stronger obfuscation (but test carefully!)

# Rename packages
# -repackageclasses 'obf'
# -flattenpackagehierarchy 'obf'

# Remove logging (reduces size, but removes debug info)
# -assumenosideeffects class java.io.PrintStream {
#     public void println(...);
#     public void print(...);
# }

# Remove printStackTrace calls
# -assumenosideeffects class java.lang.Throwable {
#     public void printStackTrace();
# }

# ============================================
# Troubleshooting
# ============================================

# If you encounter issues after obfuscation:
# 1. Check dist/mapping.txt to see what was renamed
# 2. Add specific -keep rules for classes that break
# 3. Use -keep instead of -keepnames for critical classes
# 4. Test the obfuscated JAR: java -jar dist/WareStat-1.2-obfuscated.jar

# Example: If a specific class breaks, add:
# -keep class YourClassName {
#     *;
# }
